# 王者荣耀智能助手 - 后端接口说明书

## 文档信息

| 项目 | 内容 |
|------|------|
| 项目名称 | 王者荣耀智能助手 |
| 文档版本 | v1.0.0 |
| 编写日期 | 2026-02-14 |
| 后端框架 | FastAPI |
| 文档状态 | 正式版 |

---

## 1. 接口概述

### 1.1 接口规范

- **协议**：HTTP/HTTPS
- **数据格式**：JSON
- **编码**：UTF-8
- **API版本**：v1

### 1.2 通用响应格式

#### 1.2.1 成功响应

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

#### 1.2.2 错误响应

```json
{
  "code": 400,
  "message": "错误描述",
  "data": null
}
```

### 1.3 状态码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 1.4 基础URL

- 开发环境：`http://localhost:8000`
- 生产环境：根据实际部署配置

---

## 2. 对话接口

### 2.1 发送消息

#### 接口信息

- **接口地址**：`/api/v1/chat/send`
- **请求方法**：`POST`
- **接口描述**：发送消息给AI，获取回复

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |
| message | string | 是 | 用户消息内容 |
| chat_id | string | 否 | 对话ID，首次对话可为空 |

#### 请求示例

```json
{
  "user_id": "user_001",
  "message": "鲁班七号怎么玩？",
  "chat_id": null
}
```

#### 响应参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| code | int | 状态码 |
| message | string | 响应消息 |
| data | object | 响应数据 |

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "chat_id": "chat_001",
    "reply": "鲁班七号是王者荣耀中的射手英雄，主要特点是..."
  }
}
```

---

### 2.2 获取对话历史

#### 接口信息

- **接口地址**：`/api/v1/chat/history`
- **请求方法**：`GET`
- **接口描述**：获取用户的对话历史记录

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |
| page | int | 否 | 页码，默认1 |
| page_size | int | 否 | 每页数量，默认10 |

#### 请求示例

```
GET /api/v1/chat/history?user_id=user_001&page=1&page_size=10
```

#### 响应参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| code | int | 状态码 |
| message | string | 响应消息 |
| data | object | 响应数据 |
| data.items | array | 对话列表 |
| data.total | int | 总数 |
| data.page | int | 当前页码 |
| data.page_size | int | 每页数量 |

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": "chat_001",
        "messages": [
          {
            "role": "user",
            "content": "鲁班七号怎么玩？",
            "timestamp": "2026-02-14T10:00:00"
          },
          {
            "role": "assistant",
            "content": "鲁班七号是王者荣耀中的射手英雄...",
            "timestamp": "2026-02-14T10:00:03"
          }
        ],
        "created_at": "2026-02-14T10:00:00"
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 10
  }
}
```

---

## 3. 英雄接口

### 3.1 获取英雄列表

#### 接口信息

- **接口地址**：`/api/v1/heroes`
- **请求方法**：`GET`
- **接口描述**：获取英雄列表，支持搜索和筛选

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| keyword | string | 否 | 搜索关键词 |
| position | string | 否 | 位置筛选 |
| difficulty | string | 否 | 难度筛选 |
| page | int | 否 | 页码，默认1 |
| page_size | int | 否 | 每页数量，默认20 |

#### 请求示例

```
GET /api/v1/heroes?keyword=鲁班&page=1&page_size=20
```

#### 响应参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| code | int | 状态码 |
| message | string | 响应消息 |
| data | object | 响应数据 |
| data.items | array | 英雄列表 |
| data.total | int | 总数 |
| data.page | int | 当前页码 |
| data.page_size | int | 每页数量 |

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "name": "鲁班七号",
        "title": "机关造物",
        "position": "archer",
        "difficulty": "simple",
        "image_url": "https://example.com/hero_1.jpg",
        "win_rate": 0.52,
        "ban_rate": 0.05,
        "pick_rate": 0.35
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 20
  }
}
```

---

### 3.2 获取英雄详情

#### 接口信息

- **接口地址**：`/api/v1/heroes/{hero_id}`
- **请求方法**：`GET`
- **接口描述**：获取指定英雄的详细信息

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| hero_id | int | 是 | 英雄ID |

#### 请求示例

```
GET /api/v1/heroes/1
```

#### 响应参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| code | int | 状态码 |
| message | string | 响应消息 |
| data | object | 英雄详情数据 |

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "鲁班七号",
    "title": "机关造物",
    "position": "archer",
    "difficulty": "simple",
    "description": "鲁班七号是王者荣耀中的射手英雄...",
    "image_url": "https://example.com/hero_1.jpg",
    "skills": [
      {
        "name": "河豚手雷",
        "description": "鲁班七号投掷河豚手雷...",
        "cooldown": 8,
        "cost": 60
      }
    ],
    "passive_skill": {
      "name": "火力压制",
      "description": "鲁班七号连续使用普通攻击时..."
    },
    "win_rate": 0.52,
    "ban_rate": 0.05,
    "pick_rate": 0.35,
    "counter_heroes": [2, 3],
    "countered_by_heroes": [4, 5]
  }
}
```

---

### 3.3 获取英雄装备推荐

#### 接口信息

- **接口地址**：`/api/v1/heroes/{hero_id}/equipments`
- **请求方法**：`GET`
- **接口描述**：获取指定英雄的装备推荐

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| hero_id | int | 是 | 英雄ID |
| rank | string | 否 | 段位筛选 |

#### 请求示例

```
GET /api/v1/heroes/1/equipments?rank=钻石
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "hero_id": 1,
      "rank": "钻石",
      "equipment_list": [
        "急速战靴",
        "无尽战刃",
        "影刃",
        "破晓",
        "泣血之刃",
        "复活甲"
      ],
      "win_rate": 0.55
    }
  ]
}
```

---

### 3.4 获取英雄铭文推荐

#### 接口信息

- **接口地址**：`/api/v1/heroes/{hero_id}/inscriptions`
- **请求方法**：`GET`
- **接口描述**：获取指定英雄的铭文推荐

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| hero_id | int | 是 | 英雄ID |
| rank | string | 否 | 段位筛选 |

#### 请求示例

```
GET /api/v1/heroes/1/inscriptions?rank=钻石
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "hero_id": 1,
      "rank": "钻石",
      "inscription_name": "高攻速铭文",
      "inscription_config": [
        {"name": "祸源", "count": 10},
        {"name": "无双", "count": 10},
        {"name": "鹰眼", "count": 10}
      ],
      "description": "提供高额攻击力和暴击率"
    }
  ]
}
```

---

## 4. 对局接口

### 4.1 获取对局列表

#### 接口信息

- **接口地址**：`/api/v1/matches`
- **请求方法**：`GET`
- **接口描述**：获取用户的对局列表

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |
| hero_id | int | 否 | 英雄ID筛选 |
| result | string | 否 | 结果筛选（胜利/失败） |
| page | int | 否 | 页码，默认1 |
| page_size | int | 否 | 每页数量，默认10 |

#### 请求示例

```
GET /api/v1/matches?user_id=user_001&page=1&page_size=10
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": "match_001",
        "hero_id": 1,
        "hero_name": "鲁班七号",
        "result": "胜利",
        "duration": 1200,
        "kills": 12,
        "deaths": 3,
        "assists": 8,
        "kda": 6.7,
        "created_at": "2026-02-14T10:00:00"
      }
    ],
    "total": 10,
    "page": 1,
    "page_size": 10
  }
}
```

---

### 4.2 添加对局

#### 接口信息

- **接口地址**：`/api/v1/matches`
- **请求方法**：`POST`
- **接口描述**：添加对局记录

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |
| hero_id | int | 是 | 英雄ID |
| hero_name | string | 是 | 英雄名称 |
| position | string | 否 | 位置 |
| result | string | 是 | 对局结果（胜利/失败） |
| duration | int | 是 | 对局时长（秒） |
| kills | int | 是 | 击杀数 |
| deaths | int | 是 | 死亡数 |
| assists | int | 是 | 助攻数 |
| gold | int | 否 | 金币 |
| damage | int | 否 | 输出伤害 |
| damage_taken | int | 否 | 承受伤害 |
| healing | int | 否 | 治疗量 |
| equipment_list | array | 否 | 装备列表 |
| inscription | object | 否 | 铭文配置 |
| rank | string | 否 | 对局时的段位 |

#### 请求示例

```json
{
  "user_id": "user_001",
  "hero_id": 1,
  "hero_name": "鲁班七号",
  "position": "archer",
  "result": "胜利",
  "duration": 1200,
  "kills": 12,
  "deaths": 3,
  "assists": 8,
  "gold": 18500,
  "damage": 185000,
  "damage_taken": 45000,
  "healing": 0,
  "equipment_list": [
    "急速战靴",
    "无尽战刃"
  ],
  "inscription": {
    "name": "高攻速铭文",
    "config": [
      {"name": "祸源", "count": 10}
    ]
  },
  "rank": "钻石"
}
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "match_001",
    "kda": 6.7,
    "participation_rate": 0.008
  }
}
```

---

### 4.3 获取对局详情

#### 接口信息

- **接口地址**：`/api/v1/matches/{match_id}`
- **请求方法**：`GET`
- **接口描述**：获取对局详细信息

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| match_id | string | 是 | 对局ID |

#### 请求示例

```
GET /api/v1/matches/match_001
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "match_001",
    "user_id": "user_001",
    "hero_id": 1,
    "hero_name": "鲁班七号",
    "position": "archer",
    "result": "胜利",
    "duration": 1200,
    "kills": 12,
    "deaths": 3,
    "assists": 8,
    "gold": 18500,
    "damage": 185000,
    "damage_taken": 45000,
    "healing": 0,
    "participation_rate": 0.008,
    "kda": 6.7,
    "equipment_list": [
      "急速战靴",
      "无尽战刃"
    ],
    "rank": "钻石",
    "created_at": "2026-02-14T10:00:00"
  }
}
```

---

### 4.4 删除对局

#### 接口信息

- **接口地址**：`/api/v1/matches/{match_id}`
- **请求方法**：`DELETE`
- **接口描述**：删除对局记录

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| match_id | string | 是 | 对局ID |

#### 请求示例

```
DELETE /api/v1/matches/match_001
```

#### 响应示例

```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

---

## 5. 分析接口

### 5.1 创建分析报告

#### 接口信息

- **接口地址**：`/api/v1/analysis/analyze`
- **请求方法**：`POST`
- **接口描述**：为对局创建AI分析报告

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| match_id | string | 是 | 对局ID |

#### 请求示例

```json
{
  "match_id": "match_001"
}
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "analysis_001",
    "match_id": "match_001",
    "overall_rating": "优秀",
    "highlights": [
      {"text": "KDA表现优秀(6.7)，发育和击杀平衡"}
    ],
    "mistakes": [
      {"text": "参团率低(0.8%)，团队贡献不足"}
    ],
    "suggestions": [
      {"text": "提高团战参与度，及时支援队友"}
    ],
    "report": "对局复盘报告...",
    "improvements": [
      {"text": "提高团战参与度"}
    ]
  }
}
```

---

### 5.2 获取分析报告

#### 接口信息

- **接口地址**：`/api/v1/analysis/report/{analysis_id}`
- **请求方法**：`GET`
- **接口描述**：获取分析报告详情

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| analysis_id | string | 是 | 分析ID |

#### 请求示例

```
GET /api/v1/analysis/report/analysis_001
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "analysis_001",
    "match_id": "match_001",
    "overall_rating": "优秀",
    "highlights": [
      {"text": "KDA表现优秀(6.7)，发育和击杀平衡"}
    ],
    "mistakes": [
      {"text": "参团率低(0.8%)，团队贡献不足"}
    ],
    "suggestions": [
      {"text": "提高团战参与度，及时支援队友"}
    ],
    "report": "对局复盘报告...",
    "improvements": [
      {"text": "提高团战参与度"}
    ],
    "created_at": "2026-02-14T10:00:00"
  }
}
```

---

## 6. 用户接口

### 6.1 获取用户信息

#### 接口信息

- **接口地址**：`/api/v1/user/profile`
- **请求方法**：`GET`
- **接口描述**：获取用户信息

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |

#### 请求示例

```
GET /api/v1/user/profile?user_id=user_001
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "user_001",
    "nickname": "王者荣耀玩家",
    "avatar": "https://example.com/avatar.jpg",
    "rank": "钻石",
    "stars": 3,
    "favorite_heroes": [1, 2, 3],
    "preferences": {
      "theme": "light",
      "notifications": true
    },
    "created_at": "2026-02-14T10:00:00"
  }
}
```

---

### 6.2 更新用户信息

#### 接口信息

- **接口地址**：`/api/v1/user/profile`
- **请求方法**：`PUT`
- **接口描述**：更新用户信息

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |
| nickname | string | 否 | 昵称 |
| avatar | string | 否 | 头像URL |
| rank | string | 否 | 段位 |
| stars | int | 否 | 星数 |
| preferences | object | 否 | 偏好设置 |

#### 请求示例

```json
{
  "user_id": "user_001",
  "nickname": "新昵称",
  "rank": "星耀",
  "stars": 1,
  "preferences": {
    "theme": "dark",
    "notifications": false
  }
}
```

#### 响应示例

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": "user_001",
    "nickname": "新昵称",
    "rank": "星耀",
    "stars": 1
  }
}
```

---

### 6.3 获取用户统计

#### 接口信息

- **接口地址**：`/api/v1/user/stats`
- **请求方法**：`GET`
- **接口描述**：获取用户游戏统计数据

#### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户ID |

#### 请求示例

```
GET /api/v1/user/stats?user_id=user_001
```

#### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total_matches": 100,
    "total_wins": 55,
    "win_rate": 0.55,
    "avg_kda": 5.2,
    "avg_duration": 1200,
    "favorite_heroes": [
      {
        "hero_id": 1,
        "hero_name": "鲁班七号",
        "play_count": 30,
        "win_rate": 0.6
      }
    ]
  }
}
```

---

## 7. 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 1001 | 用户不存在 |
| 1002 | 英雄不存在 |
| 1003 | 对局不存在 |
| 1004 | 分析报告不存在 |
| 1005 | 数据库错误 |
| 1006 | AI服务错误 |

---

## 8. 接口调用示例

### 8.1 Python示例

```python
import requests

# 配置
BASE_URL = "http://localhost:8000/api/v1"

# 获取英雄列表
def get_heroes():
    response = requests.get(f"{BASE_URL}/heroes")
    return response.json()

# 发送消息
def send_message(user_id, message):
    data = {
        "user_id": user_id,
        "message": message
    }
    response = requests.post(f"{BASE_URL}/chat/send", json=data)
    return response.json()

# 添加对局
def add_match(user_id, match_data):
    data = {
        "user_id": user_id,
        **match_data
    }
    response = requests.post(f"{BASE_URL}/matches", json=data)
    return response.json()
```

### 8.2 JavaScript示例

```javascript
// 配置
const BASE_URL = "http://localhost:8000/api/v1";

// 获取英雄列表
async function getHeroes() {
  const response = await fetch(`${BASE_URL}/heroes`);
  return await response.json();
}

// 发送消息
async function sendMessage(userId, message) {
  const response = await fetch(`${BASE_URL}/chat/send`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      user_id: userId,
      message: message
    })
  });
  return await response.json();
}

// 添加对局
async function addMatch(userId, matchData) {
  const response = await fetch(`${BASE_URL}/matches`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      user_id: userId,
      ...matchData
    })
  });
  return await response.json();
}
```

---

## 9. 注意事项

### 9.1 限流说明

- 同一IP每分钟最多请求60次
- 同一用户每分钟最多发送30条消息
- 超过限制将返回429状态码

### 9.2 数据格式

- 所有日期时间格式为ISO 8601：`YYYY-MM-DDTHH:mm:ss`
- 所有金额、数量等数值为整数
- 所有比例为浮点数，范围0-1

### 9.3 安全说明

- 建议使用HTTPS协议
- 敏感数据建议加密传输
- 建议实现API密钥或Token认证

### 9.4 兼容性

- 当前API版本为v1
- 后续版本将保持向后兼容
- 废弃接口将提前通知

---

**文档结束**
